{"version":3,"sources":["webpack:///webpack/bootstrap 7ad91671e4e88d763c19","webpack:///./src/main.js","webpack:///./src/app.js","webpack:///./src/dictaphone.js","webpack:///./node_modules/recorderjs/recorder.js","webpack:///./src/wsclient-worker.js","webpack:///./src/config.js"],"names":["config","parent","window","document","body","hasOwnProperty","querySelector","app","run","dictaphone","App","parentDom","options","stream","appendChild","el","navigator","getUserMedia","webkitGetUserMedia","mozGetUserMedia","audio","mandatory","googEchoCancellation","googAutoGainControl","googNoiseSuppression","googHighpassFilter","optional","gotStream","e","alert","console","log","wsWorker","addEventListener","event","AudioContext","webkitAudioContext","audioContext","audioRecorder","recordButton","container","timer","BATCH_INTERAVAL","initDom","createElement","classList","add","innerText","contains","toggle","start","stop","initRecorder","inputPoint","createGain","realAudioInput","createMediaStreamSource","audioInput","connect","zeroGain","gain","value","destination","sendVoiceBatch","buffer","postMessage","command","Dictaphone","call","apikey","clear","record","setInterval","getBuffer","clearInterval","scope","configVarName","params","Error","q","forEach","currentValue","index","array","name","Array","prototype","slice"],"mappings":"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","file":"./dist/bundle.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 0);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap 7ad91671e4e88d763c19","import Application from \"./app\";\nimport loadConfig from \"./config\";\n\nconst config = loadConfig(\"feedbackclear\")['config'];\nlet parent = window.document.body\n\nif (config.hasOwnProperty('parent')) {\n    parent = document.querySelector(config['parent']) || parent;\n}\n\nconst app = new Application(parent, config);\napp.run();\n\n\n\n\n// WEBPACK FOOTER //\n// ./src/main.js","import Dictaphone from \"./dictaphone\";\n\nlet dictaphone = null;\nlet parent = null;\n\nexport default class App {\n    constructor(parentDom, options = {}) {\n        this.options = options;\n        parent = parentDom\n    }\n\n    gotStream(stream) {\n        dictaphone = new Dictaphone(stream);\n        parent.appendChild(dictaphone.el)\n    }\n\n    run() {\n        if (!navigator.getUserMedia) {\n            navigator.getUserMedia =\n                navigator.webkitGetUserMedia || navigator.mozGetUserMedia;\n        }\n\n        navigator.getUserMedia(\n            {\n                audio: {\n                    mandatory: {\n                        googEchoCancellation: \"false\",\n                        googAutoGainControl: \"false\",\n                        googNoiseSuppression: \"false\",\n                        googHighpassFilter: \"false\"\n                    },\n                    optional: []\n                }\n            },\n            stream => this.gotStream(stream),\n            function(e) {\n                alert(\"Error getting audio\");\n                console.log(e);\n            }\n        );\n    }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/app.js","import Recorder from \"recorderjs\";\nimport Worker from \"./wsclient-worker.js\";\n\nconst wsWorker = new Worker();\nwsWorker.addEventListener(\"message\", function(event) {\n    console.log(`Message from wsworker ${event}`);\n});\n\nwindow.AudioContext = window.AudioContext || window.webkitAudioContext;\n\nlet audioContext = new AudioContext();\nlet audioRecorder = null;\nlet recordButton;\nlet container;\nlet timer = null;\nlet BATCH_INTERAVAL = 250;\n\nfunction initDom() {\n    container = document.createElement(\"div\");\n    container.classList.add(\"fcdictaphone\");\n\n    recordButton = document.createElement(\"button\");\n    recordButton.innerText = \"Play\";\n    recordButton.classList.add(\n        \"fcdictaphone__button\",\n        \"fcdictaphone__button--play\"\n    );\n    container.appendChild(recordButton);\n    recordButton.addEventListener(\"click\", e => {\n        if (recordButton.classList.contains(\"fcdictaphone__button--play\")) {\n            recordButton.innerText = \"Stop\";\n            recordButton.classList.toggle(\"fcdictaphone__button--play\");\n            recordButton.classList.toggle(\"fcdictaphone__button--stop\");\n            // call  start recording\n            this.start();\n            return;\n        }\n\n        recordButton.classList.toggle(\"fcdictaphone__button--play\");\n        recordButton.classList.toggle(\"fcdictaphone__button--stop\");\n        recordButton.innerText = \"Play\";\n        // call stop recording\n        this.stop();\n    });\n\n    return container;\n}\n\nfunction initRecorder(stream) {\n    let inputPoint = audioContext.createGain();\n    // Create an AudioNode from the stream.\n    let realAudioInput = audioContext.createMediaStreamSource(stream);\n    let audioInput = realAudioInput;\n    audioInput.connect(inputPoint);\n\n    audioRecorder = new Recorder(inputPoint);\n\n    let zeroGain = audioContext.createGain();\n    zeroGain.gain.value = 0.0;\n    inputPoint.connect(zeroGain);\n    zeroGain.connect(audioContext.destination);\n}\n\nfunction sendVoiceBatch(buffer) {\n    wsWorker.postMessage({\n        command: \"send\",\n        buffer: buffer\n    });\n}\n\nexport default class Dictaphone {\n    constructor(stream) {\n        initRecorder.call(this, stream);\n        this.el = initDom.call(this);\n\n        wsWorker.postMessage({\n            command: \"init\",\n            apikey: \"123\"\n        });\n    }\n\n    start() {\n        audioRecorder.clear();\n        audioRecorder.record();\n        timer = setInterval(() => {\n            audioRecorder.getBuffer(buffer => {\n                sendVoiceBatch(buffer);\n            });\n            audioRecorder.clear();\n        }, BATCH_INTERAVAL);\n    }\n\n    stop() {\n        audioRecorder.getBuffer(buffer => {\n            sendVoiceBatch(buffer);\n        });\n        wsWorker.postMessage({\n            command: \"stop\"\n        });\n        audioRecorder.stop();\n        clearInterval(timer);\n    }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/dictaphone.js","var WORKER_PATH = './recorderWorker.js';\n\nvar Recorder = function(source, cfg){\n  var config = cfg || {};\n  var bufferLen = config.bufferLen || 4096;\n  this.context = source.context;\n  this.node = (this.context.createScriptProcessor ||\n               this.context.createJavaScriptNode).call(this.context,\n                                                       bufferLen, 2, 2);\n  var worker = new Worker(WORKER_PATH);\n  worker.onmessage = function(e){\n    var blob = e.data;\n    currCallback(blob);\n  }\n\n  worker.postMessage({\n    command: 'init',\n    config: {\n      sampleRate: this.context.sampleRate\n    }\n  });\n  var recording = false,\n    currCallback;\n\n  this.node.onaudioprocess = function(e){\n    if (!recording) return;\n    worker.postMessage({\n      command: 'record',\n      buffer: [\n        e.inputBuffer.getChannelData(0),\n        e.inputBuffer.getChannelData(1)\n      ]\n    });\n  }\n\n  this.configure = function(cfg){\n    for (var prop in cfg){\n      if (cfg.hasOwnProperty(prop)){\n        config[prop] = cfg[prop];\n      }\n    }\n  }\n\n  this.record = function(){\n    recording = true;\n  }\n\n  this.stop = function(){\n    recording = false;\n  }\n\n  this.clear = function(){\n    worker.postMessage({ command: 'clear' });\n  }\n\n  this.getBuffer = function(cb) {\n    currCallback = cb || config.callback;\n    worker.postMessage({ command: 'getBuffer' })\n  }\n\n  this.exportWAV = function(cb, type){\n    currCallback = cb || config.callback;\n    type = type || config.type || 'audio/wav';\n    if (!currCallback) throw new Error('Callback not set');\n    worker.postMessage({\n      command: 'exportWAV',\n      type: type\n    });\n  }\n\n  source.connect(this.node);\n  this.node.connect(this.context.destination);    //this should not be necessary\n};\n\nRecorder.forceDownload = function(blob, filename){\n  var url = (window.URL || window.webkitURL).createObjectURL(blob);\n  var link = window.document.createElement('a');\n  link.href = url;\n  link.download = filename || 'output.wav';\n  var click = document.createEvent(\"Event\");\n  click.initEvent(\"click\", true, true);\n  link.dispatchEvent(click);\n}\n\nmodule.exports = Recorder;\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/recorderjs/recorder.js\n// module id = 3\n// module chunks = 0","module.exports = function() {\n  return new Worker(__webpack_public_path__ + \"81feeec91e3b39bfd99a.worker.js\");\n};\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/wsclient-worker.js\n// module id = 4\n// module chunks = 0","export default (scope) => {\n    var configVarName = window[scope],\n        params = [],\n        options = {};\n\n    if (configVarName == void(0)) {\n        throw new Error(\"Widget init with wrong config container\");\n    }\n\n    params = window[configVarName].q || [];\n    params.forEach((currentValue, index, array) => {\n        let name = Array.prototype.slice.call(currentValue, 0, 1)[0];\n        options[name] = Array.prototype.slice.call(currentValue, 1)[0];\n    });\n\n    return options;\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/config.js"],"sourceRoot":""}